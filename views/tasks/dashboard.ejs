<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> - Task Manager</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="nav">
                <div class="logo">
                    <h2><i class="fas fa-tasks"></i> TaskManager</h2>
                </div>
                
                <div class="nav-links">
                    <span class="user-name">Welcome, <%= user.name %>!</span>
                    <form action="/api/auth/logout" method="POST" class="logout-form">
                        <button type="submit" class="btn btn-outline">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <div class="dashboard-header">
                <h1>Your Tasks</h1>
                <button id="add-task-btn" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Add New Task
                </button>
            </div>

            <!-- Task Stats -->
            <div class="task-stats">
                <div class="stat-card">
                    <div class="stat-icon pending">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="pending-count">
                            <%= tasks.filter(task => task.status === 'pending').length %>
                        </h3>
                        <p>Pending</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon progress">
                        <i class="fas fa-spinner"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="progress-count">
                            <%= tasks.filter(task => task.status === 'in-progress').length %>
                        </h3>
                        <p>In Progress</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon completed">
                        <i class="fas fa-check"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="completed-count">
                            <%= tasks.filter(task => task.status === 'completed').length %>
                        </h3>
                        <p>Completed</p>
                    </div>
                </div>
            </div>

            <!-- Task Filter -->
            <div class="task-filters">
                <button class="filter-btn active" data-status="all">All Tasks</button>
                <button class="filter-btn" data-status="pending">Pending</button>
                <button class="filter-btn" data-status="in-progress">In Progress</button>
                <button class="filter-btn" data-status="completed">Completed</button>
            </div>

            <!-- Tasks List -->
            <div class="tasks-container">
                <% if (tasks.length === 0) { %>
                    <div class="no-tasks">
                        <i class="fas fa-tasks"></i>
                        <h3>No tasks yet</h3>
                        <p>Create your first task to get started!</p>
                    </div>
                <% } else { %>
                    <div class="tasks-grid">
                        <% tasks.forEach(task => { %>
                            <div class="task-card" data-status="<%= task.status %>" data-task-id="<%= task._id %>">
                                <div class="task-header">
                                    <h3><%= task.title %></h3>
                                    <div class="task-actions">
                                        <button class="btn-icon edit-btn" data-task-id="<%= task._id %>">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn-icon delete-btn" data-task-id="<%= task._id %>">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <% if (task.description) { %>
                                    <p class="task-description"><%= task.description %></p>
                                <% } %>
                                
                                <div class="task-meta">
                                    <div class="task-status">
                                        <span class="status-badge <%= task.status %>">
                                            <% if (task.status === 'pending') { %>
                                                <i class="fas fa-clock"></i> Pending
                                            <% } else if (task.status === 'in-progress') { %>
                                                <i class="fas fa-spinner"></i> In Progress
                                            <% } else { %>
                                                <i class="fas fa-check"></i> Completed
                                            <% } %>
                                        </span>
                                    </div>
                                    
                                    <div class="task-priority">
                                        <span class="priority-badge <%= task.priority %>">
                                            <% if (task.priority === 'high') { %>
                                                <i class="fas fa-exclamation"></i>
                                            <% } else if (task.priority === 'medium') { %>
                                                <i class="fas fa-minus"></i>
                                            <% } else { %>
                                                <i class="fas fa-arrow-down"></i>
                                            <% } %>
                                            <%= task.priority.charAt(0).toUpperCase() + task.priority.slice(1) %>
                                        </span>
                                    </div>
                                </div>
                                
                                <% if (task.dueDate) { %>
                                    <div class="task-due-date">
                                        <i class="fas fa-calendar"></i>
                                        Due: <%= new Date(task.dueDate).toLocaleDateString() %>
                                    </div>
                                <% } %>
                                
                                <div class="task-dates">
                                    <small>Created: <%= new Date(task.createdAt).toLocaleDateString() %></small>
                                </div>
                            </div>
                        <% }); %>
                    </div>
                <% } %>
            </div>
        </div>
    </main>

    <!-- Task Modal -->
    <div id="task-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Add New Task</h2>
                <button class="close-btn" id="close-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="task-form">
                <div class="form-group">
                    <label for="task-title">Title *</label>
                    <input type="text" id="task-title" name="title" required>
                </div>
                
                <div class="form-group">
                    <label for="task-description">Description</label>
                    <textarea id="task-description" name="description" rows="3"></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="task-status">Status</label>
                        <select id="task-status" name="status">
                            <option value="pending">Pending</option>
                            <option value="in-progress">In Progress</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="task-priority">Priority</label>
                        <select id="task-priority" name="priority">
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="task-due-date">Due Date</label>
                    <input type="date" id="task-due-date" name="dueDate">
                </div>
                
                <div class="modal-actions">
                    <button type="button" id="cancel-btn" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <span id="submit-text">Create Task</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="/js/main.js"></script>
</body>
</html>